import{_ as s,c as a,o as n,a as l}from"./app.bff64121.js";const o="/assets/rn-android-1.80672890.webp",p="/assets/rn-android-2.babceb3e.png",h=JSON.parse('{"title":"React Native 小白安卓开发历险记","description":"","frontmatter":{},"headers":[{"level":2,"title":"启动屏设置之 react-native-splash-screen","slug":"启动屏设置之-react-native-splash-screen","link":"#启动屏设置之-react-native-splash-screen","children":[]},{"level":2,"title":"打包的apk http请求无效","slug":"打包的apk-http请求无效","link":"#打包的apk-http请求无效","children":[]}],"relativePath":"diary-pit/RN-android.md"}'),e={name:"diary-pit/RN-android.md"},t=l(`<h1 id="react-native-小白安卓开发历险记" tabindex="-1"><code>React Native</code> 小白安卓开发历险记 <a class="header-anchor" href="#react-native-小白安卓开发历险记" aria-hidden="true">#</a></h1><p>从0开始，使用 <code>React Native</code> 进行 <code>android</code> 程序开发。此文主要记录开发过程中踩过的一些坑和一些开发注意事项。因为并没有适配 <code>IOS</code> 机型，所有这里均不考虑 <code>IOS</code> 系统兼容问题。 有机会刷完 <code>IOS</code> 副本，再做记录。</p><h2 id="启动屏设置之-react-native-splash-screen" tabindex="-1">启动屏设置之 <code>react-native-splash-screen</code> <a class="header-anchor" href="#启动屏设置之-react-native-splash-screen" aria-hidden="true">#</a></h2><p><a href="https://github.com/crazycodeboy/react-native-splash-screen" target="_blank" rel="noreferrer">仓库地址</a></p><p>首先按照文档进行安装使用 (android)</p><ul><li><p>第一步 <code>npm i react-native-splash-screen --save</code> 安装相关 <code>NPM</code> 包</p></li><li><p>第二步 在 <code>android/app/build.gradle</code> 文件中, 将 <code>:react-native-splash-screen</code> 项目添加为编译时依赖项：</p></li></ul><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">...</span></span>
<span class="line"><span style="color:#A6ACCD;">dependencies {</span></span>
<span class="line"><span style="color:#A6ACCD;">    ...</span></span>
<span class="line"><span style="color:#A6ACCD;">    implementation project(&#39;:react-native-splash-screen&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><ul><li>⚠️ 第三步 注意此处有坑！！！按照官方文档的步骤，会让我们在 <code>MainApplication</code> 中注册该包，然后在后面的步骤都完成之后，程序启动正常。BUT！！！</li></ul><p>到启动屏关闭之后就出现惊悚的血红色背景和苍白的错误文案：</p><p><img src="`+o+`" alt="img"></p><p>简单解释下就是，我们获取插件的方法在 <code>MainApplication</code> 中重写了两次，该 <code>Android</code> 包已经在 <code>PackageList</code> 中了，所以就不需要再自己手动添加注册包了。所以这里就可以省略掉文档中在<code>MainApplication</code> 文件中注册的操作了。（猜测可能是版本更新导致已经自动注册了～）</p><ul><li>第四步 开始配置插件, 通过更改 <code>MainActivity.java</code> 使用 <code>react-native-splash-screen</code></li></ul><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">os</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">Bundle</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// here</span></span>
<span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">com</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">facebook</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">react</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">ReactActivity</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// react-native-splash-screen &gt;= 0.3.1</span></span>
<span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">org</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">devio</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">rn</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">splashscreen</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">SplashScreen</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// here</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// react-native-splash-screen &lt; 0.3.1</span></span>
<span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">com</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">cboy</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">rn</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">splashscreen</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">SplashScreen</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// here</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">MainActivity</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">extends</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ReactActivity</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">protected</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">onCreate</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">Bundle</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">savedInstanceState</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        SplashScreen</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">show</span><span style="color:#89DDFF;">(this);</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;">// here</span></span>
<span class="line"><span style="color:#A6ACCD;">        super</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onCreate</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">savedInstanceState</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// ...other code</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><ul><li>第五步 插件使用, 创建一个名为 <code>launch_screen.xml</code> 的文件在 <code>app/src/main/res/layout</code>（<code>layout</code>如果不存在则创建 - 文件夹）。文件的内容应如下所示：</li></ul><div class="language-xml"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">&lt;?</span><span style="color:#F07178;">xml</span><span style="color:#C792EA;"> version</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1.0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;"> encoding</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">utf-8</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">?&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">RelativeLayout</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">xmlns</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http://schemas.android.com/apk/res/android</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">orientation</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">vertical</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">layout_width</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">match_parent</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">layout_height</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">match_parent</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">ImageView</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">layout_width</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">match_parent</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">layout_height</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">match_parent</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">src</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@drawable/launch_screen</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">scaleType</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">centerCrop</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">RelativeLayout</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div><p>通过创建一个 <code>launch_screen.png</code> 文件并将其放在适当的 <code>drawable</code> 文件夹中来自定义您的启动屏幕。<code>Android</code> 会自动缩放可绘制对象，因此您不必为所有手机密度提供图像。</p><p>这是文档的原话，但是注意这里不仅仅只是创建一个文件夹，需要根据不同尺寸手机创建对应的文件夹（如下图所示,文件夹内文件类型相同），如果只创建设置了 <code>drawable</code>文件夹及内容，打包出来后少部分手机会直接打不开程序，作者亲身经历此坑！所以文件配置一定要全！！！</p><p><img src="`+p+`" alt="img"></p><p>然后添加一个名为<code>primary_dark</code>的颜色在 <code>app/src/main/res/values/colors.xml</code> 文件中</p><div class="language-xml"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">&lt;?</span><span style="color:#F07178;">xml</span><span style="color:#C792EA;"> version</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1.0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;"> encoding</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">utf-8</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">?&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">resources</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">color</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">primary_dark</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">#000000</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">color</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">resources</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div><p>最后在适合的时机，在代码中把开屏图片隐藏即可</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> SplashScreen </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">react-native-splash-screen</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">WelcomePage</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">extends</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Component</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">componentDidMount</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    	</span><span style="color:#676E95;font-style:italic;">// do stuff while splash screen is shown</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// After having done stuff (such as async tasks) hide the splash screen</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">SplashScreen</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">hide</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>其他额外配置可以查看<a href="https://github.com/crazycodeboy/react-native-splash-screen" target="_blank" rel="noreferrer">原文档</a>配置</p><h2 id="打包的apk-http请求无效" tabindex="-1">打包的<code>apk</code> <code>http</code>请求无效 <a class="header-anchor" href="#打包的apk-http请求无效" aria-hidden="true">#</a></h2><p>开发调试的时候网络请求都没有问题，但是打包成 <code>apk</code> 安装后，接口请求都无法请求成功。查了资料以后发现，是因为 <code>android</code> 系统默认禁止访问不安全的请求，比如http导致的。</p>`,25),c=[t];function r(y,D,F,i,d,C){return n(),a("div",null,c)}const u=s(e,[["render",r]]);export{h as __pageData,u as default};
