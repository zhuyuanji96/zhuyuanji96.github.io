import{j as O,a as B,o as T,c as L,i as N}from"./app.fbae26df.js";const R=B("",4),j={__name:"Tetris",setup(I){let p=null,a=1,m=!1,u=!0,r=null,f=0,y=0;const w=function(o,e,l,n){const i=document.getElementById("tetrisCanvas")||document.createElement("canvas");i.id="tetrisCanvas",i.width=e*l,i.height=o*n,i.style.border="1px solid black",r=i.getContext("2d"),r.beginPath();for(let x=1;x<o;x++)r.moveTo(0,x*n),r.lineTo(e*l,x*n);for(let x=1;x<e;x++)r.moveTo(x*l,0),r.lineTo(x*l,o*n);r.closePath(),r.strokeStyle="#aaa",r.lineWidth=.3,r.stroke(),document.getElementById("gameContainer").appendChild(i)};let c=[];for(let o=0;o<20;o++){c[o]=[];for(let e=0;e<14;e++)c[o][e]="NO_BLOCK"}const s=[[{x:14/2,y:0,color:"green"},{x:14/2,y:1,color:"green"},{x:14/2,y:2,color:"green"},{x:14/2,y:3,color:"green"}],[{x:14/2+1,y:0,color:"blue"},{x:14/2,y:0,color:"blue"},{x:14/2,y:1,color:"blue"},{x:14/2-1,y:1,color:"blue"}],[{x:14/2-1,y:0,color:"orange"},{x:14/2,y:0,color:"orange"},{x:14/2,y:1,color:"orange"},{x:14/2+1,y:1,color:"orange"}],[{x:14/2,y:0,color:"red"},{x:14/2-1,y:1,color:"red"},{x:14/2,y:1,color:"red"},{x:14/2+1,y:1,color:"red"}],[{x:14/2-1,y:0,color:"pink"},{x:14/2,y:0,color:"pink"},{x:14/2-1,y:1,color:"pink"},{x:14/2,y:1,color:"pink"}],[{x:14/2,y:0,color:"yellow"},{x:14/2,y:1,color:"yellow"},{x:14/2,y:2,color:"yellow"},{x:14/2-1,y:2,color:"yellow"}],[{x:14/2-1,y:0,color:"purple"},{x:14/2-1,y:1,color:"purple"},{x:14/2-1,y:2,color:"purple"},{x:14/2,y:2,color:"purple"}]];let t=[];const v=function(){let o=Math.floor(Math.random()*s.length);t=[{x:s[o][0].x,y:s[o][0].y,color:s[o][0].color},{x:s[o][1].x,y:s[o][1].y,color:s[o][1].color},{x:s[o][2].x,y:s[o][2].y,color:s[o][2].color},{x:s[o][3].x,y:s[o][3].y,color:s[o][3].color}]},b=()=>{localStorage.removeItem("curScore"),localStorage.removeItem("tetris_status"),localStorage.removeItem("curSpeed"),u=!1,clearInterval(p),window.location.reload()},g=function(){let o=!0;for(let e=0;e<t.length;e++){if(t[e].y>=19){o=!1;break}if(c[t[e].y+1][t[e].x]!="NO_BLOCK"){o=!1;break}}if(o){for(let e=0;e<t.length;e++){let l=t[e];r.fillStyle="white",r.fillRect(l.x*28+1,l.y*28+1,26,26)}for(let e=0;e<t.length;e++){let l=t[e];l.y++}for(let e=0;e<t.length;e++){let l=t[e];r.fillStyle=l.color,r.fillRect(l.x*28+1,l.y*28+1,26,26)}}else{for(let e=0;e<t.length;e++){let l=t[e];if(l.y<1){confirm("游戏结束!是否参与排名?")&&(y=localStorage.getItem("maxScore"),y=y??0,f>=y&&localStorage.setItem("maxScore",f)),b();return}c[l.y][l.x]=l.color}C(),localStorage.setItem("tetris_status",JSON.stringify(c)),v()}},C=function(){let o=0,e=0;for(let l=0;l<20;l++){e=0;for(let n=0;n<14;n++)c[l][n]!="NO_BLOCK"&&(e++,e==14&&o++);if(o>0){curScoreEle.innerHTML=f+=100*o+100*(o-2),localStorage.setItem("curScore",f),(f=a*a*500)&&(curSpeedEle.innerHTML=a+=1,localStorage.setItem("curSpeed",a),clearInterval(p),p=setInterval(()=>g(),1e3/a));for(let n=l;n>0;n--)for(let i=0;i<14;i++)c[n][i]=c[n-1][i];k()}}},k=function(){for(let o=0;o<20;o++)for(let e=0;e<14;e++)c[o][e]!="NO_BLOCK"?(r.fillStyle=c[o][e],r.fillRect(e*28+1,o*28+1,26,26)):(r.fillStyle="white",r.fillRect(e*28+1,o*28+1,26,26))},S=function(){let o=!0;for(let e=0;e<t.length;e++){if(t[e].x<=0){o=!1;break}if(c[t[e].y][t[e].x-1]!="NO_BLOCK"){o=!1;break}}if(o){for(let e=0;e<t.length;e++){let l=t[e];r.fillStyle="white",r.fillRect(l.x*28+1,l.y*28+1,26,26)}for(let e=0;e<t.length;e++){let l=t[e];l.x--}for(let e=0;e<t.length;e++){let l=t[e];r.fillStyle=l.color,r.fillRect(l.x*28+1,l.y*28+1,26,26)}}},h=function(){let o=!0;for(let e=0;e<t.length;e++){if(t[e].x>=13){o=!1;break}if(c[t[e].y][t[e].x+1]!="NO_BLOCK"){o=!1;break}}if(o){for(let e=0;e<t.length;e++){let l=t[e];r.fillStyle="white",r.fillRect(l.x*28+1,l.y*28+1,26,26)}for(let e=0;e<t.length;e++){let l=t[e];l.x++}for(let e=0;e<t.length;e++){let l=t[e];r.fillStyle=l.color,r.fillRect(l.x*28+1,l.y*28+1,26,26)}}},E=function(){let o=!0;for(let e=0;e<t.length;e++){let l=t[e].x,n=t[e].y;if(e!=2){let i=n-t[2].y+t[2].x,d=t[2].x-l+t[2].y;if(i<0&&(h(),i=n-t[2].y+t[2].x,d=t[2].x-l+t[2].y),i<0&&(h(),i=n-t[2].y+t[2].x,d=t[2].x-l+t[2].y),i>=13&&(S(),i=n-t[2].y+t[2].x,d=t[2].x-l+t[2].y),i>=13&&(S(),i=n-t[2].y+t[2].x,d=t[2].x-l+t[2].y),c[d][i]!="NO_BLOCK"){o=!1;break}}}if(o){for(let e=0;e<t.length;e++){let l=t[e];r.fillStyle="white",r.fillRect(l.x*28+1,l.y*28+1,26,26)}for(let e=0;e<t.length;e++){let l=t[e].x,n=t[e].y;e!=2&&(t[e].x=n-t[2].y+t[2].x,t[e].y=t[2].x-l+t[2].y)}for(let e=0;e<t.length;e++){let l=t[e];r.fillStyle=l.color,r.fillRect(l.x*28+1,l.y*28+1,26,26)}}},_=o=>{switch(o){case 40:if(!u)return;g();break;case 37:if(!u)return;S();break;case 38:return u?(E(),!1):void 0;case 39:if(!u)return;h();break;case 32:if(!u)return;m?(p=setInterval(()=>g(),1e3/a),m=!1):(clearInterval(p),m=!0);break}};return O(()=>{w(20,14,28,28),window.onkeydown=i=>_(i.keyCode),document.getElementById("runOrPause").onclick=()=>_(32),document.getElementById("reStart").onclick=()=>b();const o=document.getElementById("curScoreEle"),e=document.getElementById("curSpeedEle"),l=document.getElementById("maxScoreEle"),n=localStorage.getItem("tetris_status");c=n==null?c:JSON.parse(n),k(),f=localStorage.getItem("curScore"),f=f==null?0:parseInt(f),o.innerHTML=f,a=localStorage.getItem("curSpeed"),a=a==null?1:parseInt(a),e.innerHTML=a,y=localStorage.getItem("maxScore"),y=y==null?0:parseInt(y),l.innerHTML=y,v(),p=setInterval(()=>g(),1e3/a),_(32)}),(o,e)=>R}},K=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"project/tetris.md"}'),P={name:"project/tetris.md"},z=Object.assign(P,{setup(I){return(p,a)=>(T(),L("div",null,[N(j)]))}});export{K as __pageData,z as default};
